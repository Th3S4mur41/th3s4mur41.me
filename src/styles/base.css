:root {
	--color-bg: oklch(0.25 0 0);
	--color-subtle-bg: oklch(0 0 0);
	--color-highlight: oklch(0.4 0 0);
	--color-text: oklch(1 0 0);
	--color-subtle-text: oklch(0.8 0 0);
	--color-accent: oklch(0.86 0.18 90.53);

	--main-margin: 1.5rem;
	--grid-columns: [full-width-start] 1fr [margin-start] var(--main-margin) [content-start]
		min(80ch, calc(100vi - var(--main-margin) * 2)) [content-end] var(--main-margin) [margin-end] 1fr [full-width-end];
}

@view-transition {
	/*  biome-ignore lint/correctness/noUnknownProperty: navigation is a new property for view-transition */
	navigation: auto;
}

@media (prefers-reduced-motion: no-preference) {
	:root {
		interpolate-size: allow-keywords;
	}
	html {
		scroll-behavior: smooth;
		scrollbar-gutter: stable;

		container-type: scroll-state;
	}
}

body {
	margin: unset;
	min-block-size: 100svb;
	display: flex;
	flex-direction: column;
	justify-content: stretch;
	background-color: var(--color-bg);
	font-family: system-ui, sans-serif;
	/* Keep line-height at 1.5 unless font-size exceeds 24px, then ease toward 1.2 */
	line-height: clamp(1.2, calc(36px / 1em), 1.5);
	color: var(--color-text);
}

header {
	overflow-y: clip;
	mask-image: linear-gradient(to bottom, black 90%, transparent 98%);
	mask-size: 100% 100%;
	mask-repeat: no-repeat;
	/* TODO: replace with good layout */
	& > h1 {
		position: fixed;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		border: 0;
	}

	/* hero image */
	& > img {
		margin-block-start: 10lvb;
		margin-block-end: 1rem;
		width: 100%;
		height: auto;
		max-height: 50lvb;
		object-fit: contain;
		filter: drop-shadow(0 0.25rem 0.375rem oklch(0 0 0 / 0.75));
		view-transition-name: hero-image;

		@media (prefers-reduced-motion: no-preference) {
			@supports (animation-timeline: view()) {
				animation: parallax 1ms linear both;
				animation-timeline: view();
				animation-range: exit 0% exit 100%;
			}
		}
	}
}

:is(h1, h2, h3) {
	font-weight: 300;
	line-height: 1.25;
	letter-spacing: 0.05ch;
	text-transform: uppercase;
	text-wrap: balance;
}

/* Eyebrow text above main heading */
.eyebrow {
	margin-block-end: 0.25rem;
	font-size: 1rem;
	font-weight: 600;
	text-transform: uppercase;
	letter-spacing: 0.1ch;
	color: var(--color-accent);
	text-wrap: balance;

	& + h1 {
		margin-block-start: 0;
	}
}

p {
	text-wrap: pretty;

	@media (prefers-reduced-motion: no-preference) {
		animation: fadeIn 1ms linear both;
		animation-timeline: view();
		animation-range: entry 10% entry 60%;
	}
}

main {
	flex-grow: 1;
}

main,
aside {
	display: grid;
	grid-template-columns: var(--grid-columns);
	grid-auto-rows: min-content;
	margin-block: 2rem;
	container: main / inline-size;

	& > * {
		grid-column: content;
	}
}

/* main navigation */
body > nav {
	justify-items: center;
	position: sticky;
	top: 0;
	z-index: 1;
	transition: translate 0.3s;
	container-type: scroll-state;
	container-name: sticky-nav;

	display: grid;
	grid-template: "logo nav ." / 0 1fr 0;
	align-items: center;

	& > .logo {
		grid-area: logo;
		display: none;
	}

	@media (width >= 600px) {
		grid-template: "logo nav ." / 5rem 1fr 5rem;

		& > .logo {
			display: block;
			inline-size: 100%;
			block-size: auto;
			opacity: 0;

			/* TODO: Fix when biome bug is resolved: https://github.com/biomejs/biome/issues/8840 */
			/* @container sticky-nav scroll-state(stuck: top) {
				opacity: 1;
				transition: opacity 0.3s;
			} */
		}
	}

	/* TODO: Fix when biome bug is resolved: https://github.com/biomejs/biome/issues/8842 */
	@container scroll-state (scrolled: bottom) {
		/* Hide when you scroll down */
		translate: 0 -100%;
	}

	&::before {
		grid-column: 1 / -1;
		grid-row: 1 / -1;
		display: block;
		content: "";
		inline-size: 100%;
		block-size: 100%;
		z-index: -1;

		/* TODO: Fix when biome bug is resolved: https://github.com/biomejs/biome/issues/8840 */
		/* @container scroll-state(stuck: top) {
			background: oklch(0 0 0 /0.7);
			backdrop-filter: blur(10px);
			inline-size: stretch;
			transition: background 0.3s;
		} */
	}

	& > ul {
		--border-radius: 0.5rem;
		grid-area: nav;
		display: flex;
		list-style: none;
		justify-content: center;
		margin: unset;
		padding: 0.25rem;
		border: 2px solid transparent;
		background:
			linear-gradient(var(--color-bg), var(--color-bg)),
			linear-gradient(oklch(from var(--color-bg) calc(l + 0.2) c h), oklch(from var(--color-bg) calc(l - 0.2) c h));
		background-clip: padding-box, border-box;
		background-origin: padding-box, border-box;

		box-shadow:
			0 0.125rem 1rem -0.125rem oklch(from black l c h / 0.75),
			inset 0 -0.125rem 0.125rem -0.075rem oklch(from white l c h / 0.1);
		border-radius: calc(var(--border-radius) + 0.25rem); /* inner radius + padding */

		anchor-name: --main-nav;

		@container scroll-state (stuck: top) {
			background: none;
			box-shadow: none;
		}

		@media (prefers-reduced-motion: no-preference) {
			&::before {
				content: "";
				position: absolute;
				position-anchor: --main-nav;
				background: linear-gradient(
					oklch(from var(--color-bg) calc(l + 0.05) c h),
					oklch(from var(--color-bg) calc(l - 0.2) c h)
				);
				inset: anchor(inside);
				border-radius: calc(var(--border-radius)); /* inner radius + padding */
				margin: calc(0.25rem + 2px); /* padding + border */
				transition: all 0.2s;
			}
			&:has(a:is(:hover, :focus-visible))::before {
				margin: 0;
			}
		}
	}

	& li {
		border-radius: var(--border-radius);
		z-index: 1;

		& a {
			display: block;
			padding-inline: 1.5rem;
			padding-block: 0.5rem;
			color: var(--color-text);
			text-decoration: none;
			text-transform: uppercase;
			outline-offset: 0;
			font-weight: 500;
			border-radius: var(--border-radius);

			&:is(:hover, :focus-visible) {
				color: currentcolor;
				text-shadow: 0.025em 0.025em 0.025em oklch(from currentcolor l c h / 0 5);
			}
			&[aria-current] {
				background-color: var(--color-accent);
				color: var(--color-bg);
				font-weight: 700;
			}
		}

		&:has(> a:is(:hover, :focus)) {
			anchor-name: --main-nav;
		}
	}
}

body > footer {
	--footer-surface: linear-gradient(var(--color-bg), var(--color-subtle-bg));
	--footer-ink: color-mix(in oklch, var(--color-highlight) 26%, var(--color-bg));
	--footer-splash: var(--color-subtle-bg);
	padding-block: 2rem;
	border-block-start: 2px solid transparent;
	/* Soft, full-width “ink wash” layers (no busy pattern) */
	background:
		radial-gradient(
			140% 240% at 50% -20%,
			color-mix(in oklch, var(--footer-splash) 70%, var(--color-bg)) 0%,
			var(--color-bg) 68%
		),
		radial-gradient(
			160% 240% at 50% 120%,
			color-mix(in oklch, var(--footer-ink) 70%, var(--color-bg)) 0%,
			var(--color-bg) 66%
		),
		linear-gradient(to bottom, color-mix(in oklch, var(--color-text) 3%, var(--color-bg)) 0%, var(--color-bg) 55%),
		var(--footer-surface);
	background-clip: padding-box, border-box;
	background-origin: padding-box, border-box;
	box-shadow:
		0 0.75rem 1rem -0.25rem oklch(from black l c h / 0.06),
		0 0.25rem 0.375rem -0.125rem oklch(from black l c h / 0.02);
	display: grid;
	grid-template-columns: var(--grid-columns);

	& > * {
		grid-column: content;
	}
	& > small {
		display: grid;
		grid-template: "nav to-top" "copyright copyright" / 1fr auto;
		row-gap: 1.5rem;
		justify-items: center;

		padding-block-start: 1rem;
		margin-block-start: 1rem;
		border-block-start: 1px solid oklch(0.5 0 0);

		& > .to-top {
			grid-area: to-top;
			justify-self: end;
		}
		& > nav {
			grid-area: nav;
			justify-self: start;
			display: flex;
			gap: 1.5ch;
		}
		& > .copyright {
			grid-area: copyright;
			display: flex;
			flex-direction: column;
			gap: 1em;
			align-items: center;

			& > img {
				inline-size: 15em;
				block-size: auto;
			}
		}
	}
}

@supports (color: oklch(from white l c h / 0.5)) {
	body > footer {
		--footer-ink-a: oklch(from var(--footer-ink) l c h / 0.22);
		--footer-splash-a: oklch(from var(--footer-splash) l c h / 0.2);
		--footer-text-a: oklch(from var(--color-text) l c h / 0.04);
		background:
			radial-gradient(140% 240% at 50% -20%, oklch(from var(--footer-splash-a) l c h / 1) 0%, var(--color-bg) 68%),
			radial-gradient(160% 240% at 50% 120%, oklch(from var(--footer-ink-a) l c h / 1) 0%, var(--color-bg) 66%),
			linear-gradient(to bottom, var(--footer-text-a) 0%, transparent 55%), var(--footer-surface);
	}
}

@media (prefers-contrast: more) {
	body > footer {
		background:
			radial-gradient(140% 240% at 50% -20%, var(--footer-splash) 0%, var(--color-bg) 68%),
			radial-gradient(160% 240% at 50% 120%, var(--footer-ink) 0%, var(--color-bg) 66%), var(--footer-surface);
	}
}

a {
	text-underline-offset: 0.2em;

	&:where(:focus-visible) {
		border-radius: 0.125em;
		outline: 2px solid var(--color-accent);
		outline-offset: 0.5em;
	}
}

a.to-top {
	color: inherit;
	text-decoration: none;
	&:is(:hover, :focus) {
		text-decoration: underline;
	}
	&::after {
		content: " ↑" / "";
	}
}

hr {
	border: none;
	block-size: 0.1rem;
	inline-size: stretch;
	background: linear-gradient(to right, transparent, var(--color-text), transparent);
}

a:has(> article) {
	color: inherit;
	text-decoration: none;
	border: 2px solid transparent;
	border-radius: 0.5rem;
	padding-inline: 2rem;
	padding-block: 1.5rem;

	&:is(:hover, :focus) {
		background:
			radial-gradient(circle at 50% 250%, var(--color-subtle-bg), var(--color-bg)),
			linear-gradient(var(--color-subtle-bg), var(--color-bg));
		background-clip: padding-box, border-box;
		background-origin: padding-box, border-box;

		box-shadow:
			0 0.75rem 1rem -0.25rem oklch(from black l c h / 0.06),
			0 0.25rem 0.375rem -0.125rem oklch(from black l c h / 0.02);

		h2,
		h3 {
			text-decoration: underline;
		}
	}
}

a {
	color: var(--color-accent);

	&:where(:not([class])):is(:hover, :focus) {
		color: oklch(from var(--color-accent) calc(l + 0.05) c h);
		text-shadow: 0 0 0.1em oklch(from var(--color-accent) l c h / 0.5);
	}
}

a.author {
	font-weight: 600;
	color: inherit;
	&:is(:hover, :focus) {
		color: var(--color-text);
	}
}

.emoji,
.emoji > * {
	/* avoid layout breaking when astro wraps the emoji in an additional p tag */
	display: inline;
}

.emoji > p {
	margin-block: unset;
}

li:has(> .emoji) {
	list-style-type: "";
	margin-block-end: 0.5em;

	& > .emoji {
		margin-inline-start: -4ch;
		margin-inline-end: 1.3ch;
	}
}

ol {
	list-style-position: outside; /* default */
	padding-inline-start: 1ch;
	margin-inline-start: 1em;
}

ol > li {
	position: relative;
	margin-block-end: 0.5em;
	padding-inline-start: 1.5ch;

	&::marker {
		font-weight: 600;
		color: var(--color-bg);
	}
	&::before {
		content: "";
		display: inline-block;
		position: absolute;
		top: 0;
		left: -2.3ch;
		background-color: var(--color-accent);
		border-radius: 0.25rem;
		inline-size: 2.1ch;
		block-size: 1lh;
		z-index: -1;
	}
}

button,
input {
	font: inherit;
	border-radius: 0.5em;
	border: 2px solid transparent;
	background:
		radial-gradient(circle at 50% 250%, var(--color-subtle-bg), var(--color-subtle-bg)),
		linear-gradient(var(--color-bg), var(--color-subtle-bg));
	background-clip: padding-box, border-box;
	background-origin: padding-box, border-box;

	box-shadow:
		0 0.75rem 1rem -0.25rem oklch(from black l c h / 0.06),
		0 0.25rem 0.375rem -0.125rem oklch(from black l c h / 0.02);

	&:is(:hover, :focus-within) {
		background:
			radial-gradient(circle at 50% 250%, var(--color-subtle-bg) 75%, var(--color-highlight)),
			linear-gradient(var(--color-highlight), var(--color-subtle-bg));
		background-clip: padding-box, border-box;
		background-origin: padding-box, border-box;
	}

	&:where(:focus-visible) {
		outline: 2px solid var(--color-accent);
		outline-offset: 0;
	}
}

/* hide aside if it has nothing more than a title */
aside:has(h2:only-child) {
	display: none;
}
