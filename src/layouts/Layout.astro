---
import "../index.css";

import logo from "/src/assets/logo.png";
import heroImage from "/src/assets/Th3S4mur41_no-bg.png";
import Image from "/src/components/Image.astro";
import OpenGraph from "../components/OpenGraph.astro";
import Socials from "../components/Socials.astro";

interface Props {
	title: string;
	image?: any;
	imageAlt?: string;
	noHeader?: boolean;
	canonical?: string;
	noIndex?: boolean;
	description?: string;
	published?: Date;
	keywords?: string[];
	translations?: Array<{
		language: string;
		url: string;
	}>;
}

const { title, image, description, imageAlt } = Astro.props;
const siteName = "Th3S4mur41";
const pageTitle = title ? `${title} | ${siteName}` : `${siteName}`;
const header = title ? title : `${siteName}`;
const currentYear = new Date().getFullYear();
const slug = Astro.url.pathname.replace(/^\/|\/$/g, "").replace(/\//g, "-") || "home";

// Default meta description (~150 chars) optimized for primary topics without truncation in SERPs
const desc =
	description ||
	"Personal site of Th3S4mur41: developer & martial artist sharing web development, accessibility, performance, CSS, JS, UI/UX and open source insights.";
const defaultKeywords = [
	"Th3S4mur41",
	"developer",
	"martial artist",
	"tech enthusiast",
	"personal website",
	"samurai",
	"webdev",
	"accessibility",
	"a11y",
	"css",
	"html",
	"javascript",
	"ui",
	"ux",
];
const keyWords = Array.from(new Set([...(Astro.props.keywords ?? []), ...defaultKeywords]));
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<!-- mobile -->
		<meta name="HandheldFriendly" content="true" />
		<!-- Viewport -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
		<meta name="text-scale" content="scale" />
		<!-- Local -->
		<meta name="geo.region" content="BE" />
		<meta name="geo.placename" content="La Calamine" />
		<meta name="geo.position" content="50.719355;6.014359" />
		<meta name="ICBM" content="50.719355, 6.014359" />
		<!-- Linking -->
		<meta name="application-name" content="Th3S4mur41.me" />
		<meta name="color-scheme" content="dark light" />
		<meta name="theme-color" content="#2c2b2b" media="(prefers-color-scheme: dark)" />
		<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />
    <!-- Search Engines -->
		<meta name="description" content={desc} />
		<meta name="keywords" content={keyWords.join(", ")} />
		{Astro.props.noIndex && (
			<meta name="robots" content="noindex, nofollow" />
		)}
		{Astro.props.canonical && (
			<link rel="canonical" href={Astro.props.canonical} />
		)}
		{Astro.props.translations && (
			[
				<link rel="alternate" hreflang="en" href={Astro.url.href} />,
				<link rel="alternate" hreflang="x-default" href={Astro.url.href} />,
				...Astro.props.translations.map((translation) => (
					<link rel="alternate" hreflang={translation.language} href={translation.url} />
				)),
			]
		)}
		<!-- Bluesky/Mastodon/... Profiles backlinks -->
		<link rel="me" href="https://bsky.app/profile/th3s4mur41.me" />
		<link rel="me" href="https://bsky.brid.gy/ap/th3s4mur41.me" />
		<meta name="fediverse:creator" content="@th3s4mur41@th3s4mur41.me" />
		<link rel="me" href="https://www.fronta11y.org/author/mvanderheyden/" />
		<link rel="webmention" href="https://webmention.io/th3s4mur41.me/webmention" />
		<link rel="pingback" href="https://webmention.io/th3s4mur41.me/xmlrpc" />

		<!-- Icon -->
		<link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
		<link rel="apple-touch-icon" href="/icons/favicon-180.png" />

		<!-- Open Graph data -->
		<OpenGraph title={pageTitle} description={desc} siteName={siteName} image={image} imageAlt={imageAlt} />

		<meta name="generator" content={Astro.generator} />
		<link rel="sitemap" href="/sitemap-index.xml" />
		<link rel="alternate" type="application/rss+xml" title="Th3S4mur41.me RSS" href="/feed.xml" />
		<link rel="alternate" type="application/feed+json" title="Th3S4mur41.me JSON Feed" href="/feed.json" />
		<title>{pageTitle}</title>

		<!-- Performance -->
		<script type="speculationrules">{"prerender":[{"where":{"href_matches":"/*"},"eagerness":"moderate"}],"prefetch":[{"where":{"href_matches":"/*"},"eagerness":"moderate"}]}</script>
	</head>
	<body class={slug}>
		<!-- <a href="#main" class="skip-link">Skip to main content</a> -->
		{!Astro.props.noHeader && (
			<header>
				<h1>{header}</h1>
				<Image src={heroImage} alt="Modern-day samurai kneeling in traditional armor, sword in hand, against a vibrant wall of multicolored paint splashes — symbolizing the fusion of ancient warrior spirit with contemporary creativity." loading="eager" fetchpriority="high" />
			</header>
		)}
		<nav aria-label="main">
			<Image class="logo" src={logo} alt="" />
			<ul>
				<li><a href="/" aria-current={Astro.url.pathname === '/' ? 'page' : undefined}>Home</a></li>
				<li><a href="/blog/" aria-current={Astro.url.pathname === '/blog/' ? 'page' : undefined}>Blog</a></li>
				<!-- <li><a href="/projects">Projects</a></li> -->
				<li><a href="/about/" aria-current={Astro.url.pathname === '/about/' ? 'page' : undefined}>About me</a></li>
			</ul>
		</nav>
		<main id="main">
			<slot />
		</main>
		<slot name="aside" />
		<footer>
			<Socials />
			<small>
				<a href="#" class="to-top">To the top</a>
				<nav aria-label="footer">
					<a href="https://github.com/Th3S4mur41/th3s4mur41.me/issues" target="_blank" rel="noopener noreferrer">Feedback</a>
					<a href="/feed.xml">RSS</a>
					<a href="/feed.json">JSON feed</a>
				</nav>
				<div class="copyright">
					<Image
						src={logo}
						alt="Th3S4mur41.me logo"
						loading="lazy"
						decoding="async"
					/>
					<span>© 2024-{currentYear}</span>
				</div>

			</small>
		</footer>
	</body>
</html>

